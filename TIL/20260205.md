## 목차

1. AWS 요금 정책
2. AWS 리전, AZ
3. AWS 실습

---

### 1) AWS 요금 정책

- 비용 최적화와 책임을 구분하기 위한 여러 정책사용
- 온디맨드
  - 선결제, 약정 제약 없음
  - 불규칙한 단기 워크로드에 적합
- 스팟
  - 예비 EC2 할당
  - 온디맨드 최대 90% 절감
  - AWS에서 일방적으로 EC2 회수 가능
- 예약
  - 1년 또는 3년 약정
  - 온디맨드에 대비 72% 절감
- Compute Saving Plans
  - 컴퓨터 사용량이 일정한 경우
  - 1년 또는 3년 약정
  - 온디맨드 대비 66% 절감
- 전용 인스턴스
  - 단일 고객용 하드웨어 VPC에서 실행되는 EC2 인스턴스
  - 온디맨드 대비 높은 비용
- 전용 호스트
  - 하나의 물리적 서버
  - AWS에서 제일 높은 비용

### 2) AWS 리전, AZ

- 리스크 분배, 글로벌 서비스 최적화를 위한 전략
- 그로벌 서비스인 리전
  - 리전은 둘 이상의 AZ로 구성
- AZ는 하나 이상의 데이터베이스 센터로 구성
- 해당 서비스들과 상호 작용 하는 방법
  - AWS 콘솔
  - AWS CLI
  - SDK

### 3) AWS 실습

1. AWS CLI 설정
   - mac OS 터미널에서 설정

   ```yaml
   curl "https://awscli.amazonaws.com/AWSCLIV2.pkg" -o "AWSCLIV2.pkg"
   sudo installer -pkg AWSCLIV2.pkg -target /
   ```

2. CloudFormation 설정
   1. AWS 서비스를 코드화
   2. 동일한 환경 구현 가능
   3. 일괄 삭제, 관리 가능
   4. yaml 파일 작성 예시

   ```yaml
   AWSTemplateFormatVersion: 2010-09-09
   Description: 'AWS Technical Essentials: Introduction to AWS Identity and Access Management'

   Parameters:
     AdministratorPassword:
       Type: String
       NoEcho: True

     PublicSubnet1Param:
       Description: Public Subnet 1
       Type: String
       Default: 10.1.11.0/24
       AllowedValues:
         - 10.1.11.0/24

     VPCCIDR:
       Description: CIDR Block for VPC
       Type: String
       Default: 10.1.0.0/16
       AllowedValues:
         - 10.1.0.0/16

     InstanceType:
       Default: t3.micro
       Description: EC2 instance type, e.g. m1.small, m1.large, etc.
       Type: String

     AmazonLinuxAMIID:
       Type: AWS::SSM::Parameter::Value<AWS::EC2::Image::Id>
       Default: /aws/service/ami-amazon-linux-latest/amzn-ami-hvm-x86_64-gp2

   Resources:
     VPC:
       Type: AWS::EC2::VPC
       Properties:
         CidrBlock: !Ref VPCCIDR
         EnableDnsSupport: true
         EnableDnsHostnames: true
         Tags:
           - Key: Name
             Value: Lab VPC

     InternetGateway:
       Type: AWS::EC2::InternetGateway
       DependsOn: VPC

     AttachGateway:
       Type: AWS::EC2::VPCGatewayAttachment
       Properties:
         VpcId: !Ref VPC
         InternetGatewayId: !Ref InternetGateway

     PublicSubnet1:
       Type: AWS::EC2::Subnet
       DependsOn: AttachGateway
       Properties:
         VpcId: !Ref VPC
         MapPublicIpOnLaunch: true
         CidrBlock: !Ref PublicSubnet1Param
         AvailabilityZone: !Select
           - 0
           - !GetAZs
         Tags:
           - Key: Name
             Value: Public Subnet 1

     PublicRouteTable:
       Type: AWS::EC2::RouteTable
       DependsOn: PublicSubnet1
       Properties:
         VpcId: !Ref VPC
         Tags:
           - Key: Name
             Value: Public

     PublicRoute:
       Type: AWS::EC2::Route
       Properties:
         RouteTableId: !Ref PublicRouteTable
         DestinationCidrBlock: 0.0.0.0/0
         GatewayId: !Ref InternetGateway

     PublicSubnet1RouteTableAssociation:
       Type: AWS::EC2::SubnetRouteTableAssociation
       DependsOn: PublicRoute
       Properties:
         SubnetId: !Ref PublicSubnet1
         RouteTableId: !Ref PublicRouteTable

     Ec2Server:
       DependsOn: PublicSubnet1RouteTableAssociation
       Type: AWS::EC2::Instance
       Properties:
         ImageId: !Ref AmazonLinuxAMIID
         InstanceType: !Ref InstanceType
         SecurityGroupIds:
           - !Ref Ec2SecurityGroup
         SubnetId: !Ref PublicSubnet1

     Ec2SecurityGroup:
       Type: AWS::EC2::SecurityGroup
       Properties:
         GroupDescription: VPC Security Group
         VpcId: !Ref VPC
         SecurityGroupIngress:
           - CidrIp: 0.0.0.0/0
             FromPort: 22
             IpProtocol: tcp
             ToPort: 22

     S3Bucket:
       Type: AWS::S3::Bucket

     user1:
       Type: AWS::IAM::User
       Properties:
         Path: /tech-ess-5-lab1/
         UserName: user-1
         LoginProfile:
           Password: !Ref AdministratorPassword

     user2:
       Type: AWS::IAM::User
       Properties:
         Path: /tech-ess-5-lab1/
         UserName: user-2
         LoginProfile:
           Password: !Ref AdministratorPassword

     user3:
       Type: AWS::IAM::User
       Properties:
         Path: /tech-ess-5-lab1/
         UserName: user-3
         LoginProfile:
           Password: !Ref AdministratorPassword

     S3support:
       Type: AWS::IAM::Group
       Properties:
         Path: /tech-ess-5-lab1/
         GroupName: S3-Support
         ManagedPolicyArns:
           - arn:aws:iam::aws:policy/AmazonS3ReadOnlyAccess

     EC2admin:
       Type: AWS::IAM::Group
       Properties:
         Path: /tech-ess-5-lab1/
         GroupName: EC2-Admin
         Policies:
           - PolicyName: EC2-Admin-Policy
             PolicyDocument:
               Version: '2012-10-17'
               Statement:
                 - Effect: Allow
                   Action:
                     - ec2:Describe*
                     - ec2:StartInstances
                     - ec2:StopInstances
                     - cloudwatch:DescribeAlarms
                   Resource:
                     - '*'

     EC2support:
       Type: AWS::IAM::Group
       Properties:
         Path: /tech-ess-5-lab1/
         GroupName: EC2-Support
         ManagedPolicyArns:
           - arn:aws:iam::aws:policy/AmazonEC2ReadOnlyAccess

   Outputs:
     AdministratorPassword:
       Value: !Ref AdministratorPassword

     InstanceId:
       Value: !Ref Ec2Server

     Region:
       Value: !Ref AWS::Region

     S3Bucket:
       Value: !Ref S3Bucket
   ```
