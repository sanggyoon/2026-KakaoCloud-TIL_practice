## 목차

1. 웹 서비스 부하 테스트 실습

---

## 1) 웹서비스 부하 테스트 실습

1. ec2 생성
   - OS: amazon linux2 2023
2. wordpress 설치

   https://docs.aws.amazon.com/ko_kr/linux/al2023/ug/hosting-wordpress-aml-2023.html

3. AMI 생성
4. 로드밸런서 생성, 설정
5. 타겟 그룹 생성, 설정
6. 오토스케일링 생성, 설정
7. k6 설치, locust 설치

   ```bash
   # 저장소 등록
   sudo tee /etc/yum.repos.d/k6.repo <<EOF
   [k6]
   name=k6
   baseurl=https://dl.k6.io/rpm/
   enabled=1
   gpgcheck=1
   gpgkey=https://dl.k6.io/key.gpg
   EOF

   # 설치
   sudo yum install k6 -y

   # 설치 확인
   k6 version
   ```

   ```bash
   # pip 설치
   sudo yum install python3-pip -y

   # pip 업데이트
   python3 -m pip install --upgrade pip

   # locust 설치
   pip3 install locust

   # 설치 확인
   locust --version
   ```

- k6 실습 코드
  ```bash
  import http from 'k6/http';
  import { sleep, check } from 'k6';
  export const options = {
  	vus: 20, // 동시 접속자(Virtual Users) 20명
  	duration: '1m'
  	, // 1분 동안 테스트 지속
  	};
  export default function () {
  	const res = http.get('http://수강생-웹사이트-주소');
  	// 상태 코드가 200인지 체크
  	check(res, { 'status is 200': (r) => r.status === 200 });
  	sleep(1);
  }
  ```
  ```bash
  k6 run script.js
  ```
- locust 실습 코드
  ```bash
  from locust import HttpUser, task, between

  class WebsitUser(HttpUser):
  	wait_time = between(1, 2.5)

  	@task
  	def access_main(self):
  		self.client.get("/")

  	@task(3)
  	def access_detail(self):
  		self.client.get("/detail")
  ```
  ```bash
  locust -f locustfile.py
  ```
  ```bash
  # UI 접속
  http://localhost:8089
  ```
